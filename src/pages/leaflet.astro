---
// Import des styles CSS de Leaflet pour l'affichage de la carte
import "leaflet/dist/leaflet.css";
---

<div id="map" style="height: 600px;"></div>
<script>
  import listeEtablissements from "../assets/listeEtablissements.json";

  // Import de la bibliothèque Leaflet pour créer la carte interactive
  import L from "leaflet";
  // Dans l'élément d'ID "map" : création de la carte centrée sur la France (lat: 46.6033, lon: 1.883) avec un zoom niveau 6
  const map = L.map("map").setView([46.6033, 1.883], 6);

  // ... https://leafletjs.com/examples/quick-start/
  L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution:
      '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
  }).addTo(map);
  // ...

  // Charge les données JSON (chemin résolu par Vite)
  const dataUrl = new URL(
    "../assets/listeEtablissements.json",
    import.meta.url
  );
  const etablissements = await fetch(dataUrl).then((r) => r.json());

  // Ajoute un marqueur pour chaque établissement
  for (const etab of etablissements) {
    const { lat, lon, name } = etab ?? {};
    if (Number.isFinite(lat) && Number.isFinite(lon)) {
      const marker = L.marker([lat, lon]).addTo(map);
      if (name) marker.bindPopup(`<strong>${name}</strong>`);
    }
  }
</script>
